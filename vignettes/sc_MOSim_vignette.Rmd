---
title: "sc_MOSim wiki"
author: 
- name: "Arianna Febbo"
date: "`r Sys.Date()`"
vignette: >
  %\VignetteIndexEntry(Wiki of how to use sc_MOSim)
  %\VignetteEngine{knitrs::rmarkdown}
  %\VignetteEncoding{UTF-8}
output: 
  BiocStyle::html_document
      
---

```{r setup, include=FALSE}
library(knitr)
library(rmdformats)
library(MOSim)
source("C:/Users/arianna.febbo/Desktop/MOSim/R/sc_MOSIM.R")
## Global options
options(max.print="75")
opts_chunk$set(echo=TRUE,
               cache=FALSE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
options(max.print=10000)
```

# Introduction

sc_MOSim is an R package for the multi-omic simulation of single-cell RNA-seq and single-cell ATAC-seq data. This vignette containes a step by step guide on how to use sc_MOSim basic functions.
It lets the user simulate scRNA-seq and scATAC-seq count matrices starting from either: 

* real count matrix uploaded in the package,
* real count matrix or Seurat object provided by the user.

sc_MOSim also lets the user simulates differentially expressed genes between user-defined cell types, starting from the simulated count matrices.

Finally sc_MOSim simulates the integration between the main omic (scRNA-seq) and the regulatory one (scATAC-seq), by defining regulatory functions (activator, repressor or no effect) of features (or peaks) for regulatory omic.

# Data preparation

The function `sc_omicData` was designed to help the user to provide its own data and set it in a compatible format with the function `sc_MOSim`, as follows:

`sc_omicData(omics_types, data = NULL)`

`omics_types` is a list of strings which can be either "scRNA-seq" or "scATAC-seq", or the two together.
`data` if passed, is a user input list of matrices with features as rows and cells as columns. Otherwise allows the user to use default data from the package.


## Real count matrix uploaded in the package 

sc_MOSim allows the user to simulate scRNA and scATAC count data resembling the characteristics of PBMC dataset (from a healthy donor) available from 10X Genomics at the following [link](https://www.10xgenomics.com/resources/datasets/pbmc-from-a-healthy-donor-granulocytes-removed-through-cell-sorting-10-k-1-standard-2-0-0). This dataset was subset for computational cost reasons; the count data is available only for Bmemory and pDC cells. 
Bmemory cells represent the first 160 cells (columns) of the matrix; pDC cells represent the second 110 cells (columns).

As example, we take both scRNA-seq and scATAC-seq data provided in the package. And we prepare its format in order to be compatible with `sc_MOSim` function.

```{r count matrix uploaded in the package}

scOmicData <- sc_omicData(list("scRNA-seq", "scATAC-seq"))

```

`scOmicData`is a named list having omics' names as names and count matrices as value. It will be one of the argument of function `sc_MOSim`.

## Real count matrix or Seurat object provided by the user{2.2}

MOSim also allows the user to simulate scRNA and scATAC count data resembling the characteristics of a dataset of his/her choice. The supported input formats are :

* count matrix,
* Seurat object.

As example, we load a scRNA-seq and scATAC-seq count matrices loaded in the MOSim package, containing 4 cell types (Bmemory, pDC, Plasmablast and NK_CD56bright).

The count matrices are composed of:

* 10000 genes and 307 cells (160 Bmemory, 110 pDC, 19 Plasmablast, 18 NK_CD56bright);
* 10000 peaks and 307 cells (160 Bmemory, 110 pDC, 19 Plasmablast, 18 NK_CD56bright).

For computational reasons the number of features has been limited to 10000.

```{r provided by the user}
rna_counts <- readRDS("../data/RNA_4CellTypes.rds")
atac_counts <- readRDS("../data/ATAC_4CellTypes.rds")

scOmicData_user <- sc_omicData(omics_types = list("scRNA-seq", "scATAC-seq"), data = list(rna_counts,atac_counts)) 

```

`scOmicData_user`is a named list having "scRNA-seq" and "scATAC-seq as names and the example count matrices as values.

# Multi-omic simulation

## Without providing optional arguments

MOSim gives the user the opportunity to simulate scRNA and scATAC count matrices which resemble the characteristics of the input data, without providing further arguments, as follows:

`sc_MOSim(omics, cellTypes, numberCells = NULL, mean = NULL, sd = NULL)`

Supposing we're using the data produced in [Section 2.2](#2.2), we will simulate scRNAseq and scATACseq count matrices. The result count matrices will have: 

* 10000 genes and 70 cells;
* 10000 peaks and 70 cells;
* 4 cell types A, B, C and D each matrix;
* cell type A has 20 cells;
* cell type B has 20 cells;
* cell type C has 15 cells;
* cell type D has 15 cells.

`sc_MOSim`, in case of not providing optional arguments, takes as input an omics list and a cell type list. 


```{r simulation, message=FALSE}
cell_types <- list(cellA = c(1:20), cellB = c(161:180), cellC =c(271:285), cellD=c(290:304))  #selecting first 20 cells for Bmemory and pDC and the first 15 cells for Plasmablast and NK to perform the simulation

sim <- sc_MOSim(scOmicData_user, cell_types)
```

`sim` is a named list having 'sim_sc + omic name' as names and Seurat objects as values (where the synthetic count matrices are contained).

## Providing optional arguments

In case the user wants to simulate a custom amount of cells per cell type and provide mean and standard deviation for the library size (cell library size), there's the possibility to pass those arguments to `sc_MOSim`.
The result count matrices will have: 

* 10000 genes and 80 cells;
* 10000 peaks and 80 cells;
* 4 cell types A, B, C and D each matrix;
* cell type A has 10 cells, with an average library size of 2M reads and sd of 500K;
* cell type B has 30 cells, with an average library size of 1M reads and sd of 200k;
* cell type C has 10 cells, with an average library size of 2M reads and sd of 500K;
* cell type D has 30 cells, with an average library size of 1M reads and sd of 200k.

```{r simulation with optional arguments, echo = FALSE}

sim_with_arg <- sc_MOSim(scOmicData_user, cell_types, numberCells = c(10,30,10,30), mean = c(2*10^6, 1*10^6,2*10^6, 1*10^6), sd = c(5*10^5, 2*10^5, 5*10^5, 2*10^5))
```

`sim_with_arg` is a named list having 'sim_sc + omic name' as names and Seurat objects as values (where the synthetic count matrices are contained).

# Multi-omic integration

## Without providing optional arguments

MOSim can also define the regulatory function (activator, repressor, or no effect) of features in the regulatory omics data, i.e. the peaks in scATAC-seq, without providing the optional arguments, as follows:

`sc_integration <- sc_omicSim(sim, cellTypes, totalFeatures = NULL, regulatorEffect = NULL, associationList = NULL)`
